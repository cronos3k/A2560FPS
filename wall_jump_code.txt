  // ====== WALL JUMP MECHANICS (Non-destructive, optional) ======
  // Only active when settings.wall_jump_enabled is true
  if (settings.wall_jump_enabled && gravity() && floating() == 0)
  {
    // Wall detection: check for solid foreground tiles adjacent to player
    int player_tile_x = x / current_level->foreground()->width();
    int player_tile_y = y / current_level->foreground()->height();

    int wall_left = 0;
    int wall_right = 0;

    // Check tile to the left
    if (player_tile_x > 0)
    {
      uint16_t tile_left = current_level->foreground()->get_cell(player_tile_x - 1, player_tile_y);
      if (tile_left != 0) // Non-zero tile = solid
        wall_left = 1;
    }

    // Check tile to the right
    if (player_tile_x < current_level->foreground()->width_in_tiles() - 1)
    {
      uint16_t tile_right = current_level->foreground()->get_cell(player_tile_x + 1, player_tile_y);
      if (tile_right != 0)
        wall_right = 1;
    }

    // Track wall holding: player must hold toward wall while falling
    if (yvel() > 0) // Falling
    {
      if ((cx < 0 && wall_left) || (cx > 0 && wall_right))
      {
        // Holding toward wall
        wall_hold++;

        // Latch onto wall when hold threshold is reached
        if (wall_hold >= settings.wall_hang_hold_frames && !wall_hanging())
        {
          set_wall_hanging(true);
          wall_side = (wall_left ? -1 : 1);

          // Reduce falling speed when latching
          set_yvel(yvel() / 4);
        }
      }
      else
      {
        // Not holding toward wall - reset counter
        wall_hold = 0;

        // If was hanging, detach and start coyote time
        if (wall_hanging())
        {
          set_wall_hanging(false);
          wall_coyote = settings.wall_coyote_frames;
        }
      }
    }
    else
    {
      // Not falling - reset wall hold
      wall_hold = 0;
    }

    // Wall hanging mechanics
    if (wall_hanging())
    {
      // Slow down falling while hanging on wall
      if (yvel() > 2)
        set_yvel(2);

      // Keep player pressed against wall
      if (wall_side < 0)
        set_xvel(-1);
      else
        set_xvel(1);
    }

    // Wall jump: jump while hanging or during coyote time
    if ((wall_hanging() || wall_coyote > 0) && cy < 0)
    {
      // Launch off the wall
      set_wall_hanging(false);
      wall_coyote = 0;

      // Vertical velocity (same as normal jump)
      set_yvel(get_ability(type(), jump_yvel));

      // Horizontal velocity (push away from wall)
      int wall_jump_xvel = get_ability(type(), jump_top_speed);
      if (wall_side < 0)
      {
        // Was on left wall, jump right
        set_xvel(wall_jump_xvel);
        direction = 1;
      }
      else
      {
        // Was on right wall, jump left
        set_xvel(-wall_jump_xvel);
        direction = -1;
      }

      wall_side = 0;
      set_gravity(1);
      set_state(run_jump);
    }

    // Update coyote time countdown
    if (wall_coyote > 0)
      wall_coyote--;
  }
  else if (!settings.wall_jump_enabled)
  {
    // Wall jump disabled - reset all state
    set_wall_hanging(false);
    wall_side = 0;
    wall_coyote = 0;
    wall_hold = 0;
  }
  // ====== END WALL JUMP MECHANICS ======

